---
interface Props {
  currentPath?: string;
}

const { currentPath = "/" } = Astro.props;
const isHome = currentPath === "/";

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/portfolio", label: "Portfolio" },
  { href: "/o-nas", label: "O nas" },
  { href: "/kontakt", label: "Kontakt" },
];
---

<header
  class={`fixed top-0 left-0 right-0 z-50 transition-all duration-500 ${isHome ? "text-white" : "bg-white/95 backdrop-blur-sm shadow-sm text-charcoal"}`}
  id="header"
  data-is-home={isHome}
>
  <nav class="relative flex items-center justify-between px-6 md:px-12 py-6">
    <!-- Logo -->
    <a href="/" class="z-50 flex flex-col items-start group">
      <img
        id="header-logo"
        src={isHome ? "/logo-white.png" : "/logo-dark.png"}
        alt="Fiodorow Photography"
        class="h-10 md:h-14 w-auto object-contain transition-opacity duration-300"
      />
    </a>

    <!-- Desktop Navigation (Centered) -->
    <div class="hidden md:block absolute left-1/2 -translate-x-1/2">
      <ul class="flex items-center gap-8">
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class:list={[
                  "nav-link text-sm tracking-[0.2em] uppercase transition-colors",
                  isHome
                    ? "text-white nav-link-white"
                    : "text-charcoal hover:text-olive",
                  {
                    "font-semibold":
                      currentPath === link.href ||
                      (link.href !== "/" && currentPath.startsWith(link.href)),
                  },
                ]}
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>
    </div>

    <!-- Mobile Menu Button -->
    <div class="md:hidden ml-auto z-50">
      <button
        class="flex flex-col gap-1.5 p-2"
        id="mobile-menu-btn"
        aria-label="Menu"
      >
        <span
          class={`w-6 h-px transition-all duration-300 ${isHome ? "bg-white" : "bg-charcoal"}`}
          id="menu-line-1"></span>
        <span
          class={`w-6 h-px transition-all duration-300 ${isHome ? "bg-white" : "bg-charcoal"}`}
          id="menu-line-2"></span>
        <span
          class={`w-4 h-px transition-all duration-300 ${isHome ? "bg-white" : "bg-charcoal"}`}
          id="menu-line-3"></span>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div
    class="fixed inset-0 bg-white z-40 flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-500"
    id="mobile-menu"
  >
    <ul class="flex flex-col items-center gap-8">
      {
        navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class="font-serif text-2xl tracking-[0.2em] uppercase text-charcoal hover:text-olive transition-colors"
            >
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</header>

<style>
  /* White underline for transparent header */
  .nav-link-white::after {
    background-color: white !important;
  }
</style>

<script>
  // Mobile menu toggle
  const header = document.getElementById("header");
  const menuBtn = document.getElementById("mobile-menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const line1 = document.getElementById("menu-line-1");
  const line2 = document.getElementById("menu-line-2");
  const line3 = document.getElementById("menu-line-3");
  let isOpen = false;

  const updateHeader = () => {
    const logo = document.getElementById("header-logo") as HTMLImageElement;
    // We need to read the initial state from the DOM attribute
    const isHome = header?.getAttribute("data-is-home") === "true";

    // IF MENU IS OPEN: FORCE CLEAN STATE (No BG, Dark Logo/Lines)
    if (isOpen) {
      header?.classList.remove(
        "bg-white/95",
        "backdrop-blur-sm",
        "shadow-sm",
        "text-white",
      );
      header?.classList.add("text-charcoal");

      // Logo must be dark because menu bg is white
      if (logo) logo.src = "/logo-dark.png";

      return;
    }

    // NORMAL STATE (Menu Closed)
    if (window.scrollY > 50 || !isHome) {
      // Scrolled OR not home -> White BG, Dark Text, Dark Logo
      header?.classList.add(
        "bg-white/95",
        "backdrop-blur-sm",
        "shadow-sm",
        "text-charcoal",
      );
      header?.classList.remove("text-white");

      if (logo) logo.src = "/logo-dark.png";

      // Update nav links color
      const links = document.querySelectorAll(".nav-link");
      links.forEach((link) => {
        link.classList.remove("text-white", "nav-link-white");
        link.classList.add("text-charcoal", "hover:text-olive");
      });

      [line1, line2, line3].forEach((line) => {
        line?.classList.remove("bg-white");
        line?.classList.add("bg-charcoal");
      });
    } else {
      // Home AND Top -> Transparent BG, White Text, White Logo
      header?.classList.remove(
        "bg-white/95",
        "backdrop-blur-sm",
        "shadow-sm",
        "text-charcoal",
      );
      header?.classList.add("text-white");

      if (logo) logo.src = "/logo-white.png";

      // Update nav links color
      const links = document.querySelectorAll(".nav-link");
      links.forEach((link) => {
        link.classList.add("text-white", "nav-link-white");
        link.classList.remove("text-charcoal", "hover:text-olive");
      });

      [line1, line2, line3].forEach((line) => {
        line?.classList.add("bg-white");
        line?.classList.remove("bg-charcoal");
      });
    }
  };

  menuBtn?.addEventListener("click", () => {
    isOpen = !isOpen;

    if (isOpen) {
      mobileMenu?.classList.remove("opacity-0", "pointer-events-none");
      mobileMenu?.classList.add("opacity-100", "pointer-events-auto");
      document.body.style.overflow = "hidden"; // Lock scroll

      // Disable transition immediately to prevent "fading out" of the white header background
      header?.classList.add("!transition-none");

      // Trigger update to clear header BG immediately
      updateHeader();

      // Re-enable transition after a small tick so future animations (like scrolling) still work
      // effectively we just wanted the BG removal to be instant
      requestAnimationFrame(() => {
        setTimeout(() => {
          header?.classList.remove("!transition-none");
        }, 50);
      });

      // Animate hamburger to X
      // Lines to dark when menu is open (because menu bg is white)
      [line1, line2, line3].forEach((line) => {
        line?.classList.remove("bg-white");
        line?.classList.add("bg-charcoal");
      });

      line1?.classList.add("rotate-45", "translate-y-[7px]");
      line2?.classList.add("opacity-0");
      line3?.classList.add("-rotate-45", "-translate-y-[3px]", "w-6");
    } else {
      mobileMenu?.classList.add("opacity-0", "pointer-events-none");
      mobileMenu?.classList.remove("opacity-100", "pointer-events-auto");
      document.body.style.overflow = ""; // Unlock scroll

      // Revert lines animation
      line1?.classList.remove("rotate-45", "translate-y-[7px]");
      line2?.classList.remove("opacity-0");
      line3?.classList.remove("-rotate-45", "-translate-y-[3px]", "w-6");

      // Re-apply header state (bg, colors) based on scroll/page
      updateHeader();
    }
  });

  window.addEventListener("scroll", updateHeader);
  updateHeader();
</script>
